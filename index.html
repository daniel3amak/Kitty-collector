<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cat Trader Multiplayer</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fafafa; margin:0; padding:20px; }
    #app { max-width: 900px; margin: auto; padding: 20px; background: white; box-shadow: 0 0 10px #ccc;}
    #login, #game { display: none; }
    button { padding: 8px 15px; margin: 5px; cursor: pointer; }
    #cats, #inventory { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 10px; }
    .cat { border: 1px solid #ccc; padding: 10px; width: 130px; text-align: center; border-radius: 8px; background: #fff;}
    .cat img { width: 100%; height: 100px; object-fit: cover; border-radius: 8px; }
    #leaderboard { margin-top: 20px; }
    #leaderboard h3 { margin-bottom: 5px; }
    #leaderboard ul { list-style:none; padding: 0; }
    #leaderboard li { background: #eee; margin: 3px 0; padding: 6px; border-radius: 5px; }
    #audioControl { position: fixed; top: 10px; right: 10px; background: #fff; padding: 8px 12px; border-radius: 6px; box-shadow: 0 0 5px #aaa; }
  </style>
</head>
<body>

<div id="app">
  <h1>Cat Trader Multiplayer</h1>

  <div id="login">
    <input type="text" id="username" placeholder="Email" maxlength="50" />
    <input type="password" id="password" placeholder="Password" />
    <button id="btnLogin">Login</button>
    <button id="btnSignup">Sign Up</button>
    <p id="loginMsg" style="color:red;"></p>
  </div>

  <div id="game">
    <p>Welcome, <span id="displayName"></span>! <button id="btnLogout">Logout</button></p>
    <h2>Market</h2>
    <div id="cats"></div>
    <h2>Your Inventory</h2>
    <div id="inventory"></div>
    <h2>Global Leaderboard</h2>
    <div id="leaderboard"><ul id="leaderboardList"></ul></div>
  </div>
</div>

<div id="audioControl">
  <button id="toggleMusic">Mute Music</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<!-- Sounds -->
<audio id="meowSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_47bda3247c.mp3"></audio>
<audio id="coinSound" src="https://cdn.pixabay.com/audio/2022/03/15/audio_6432cf0ab3.mp3"></audio>
<audio id="discoverSound" src="https://cdn.pixabay.com/audio/2022/03/07/audio_5c2f3a217d.mp3"></audio>
<audio id="clickSound" src="https://cdn.pixabay.com/audio/2022/10/31/audio_e9ed9e15f1.mp3"></audio>
<audio id="bgMusic" src="https://cdn.pixabay.com/audio/2023/04/21/audio_d122d6f736.mp3" loop autoplay></audio>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBz_FIBB3zzOeg5AQo7iZ",
    authDomain: "cat-trader.firebaseapp.com",
    projectId: "cat-trader",
    storageBucket: "cat-trader.appspot.com",
    messagingSenderId: "1234567890",
    appId: "1:1234567890:web:catgame123"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const meowSound = document.getElementById("meowSound");
  const coinSound = document.getElementById("coinSound");
  const discoverSound = document.getElementById("discoverSound");
  const clickSound = document.getElementById("clickSound");
  const bgMusic = document.getElementById("bgMusic");

  document.querySelectorAll("button").forEach(btn => {
    btn.addEventListener("click", () => clickSound.play());
  });

  document.getElementById("toggleMusic").onclick = () => {
    bgMusic.muted = !bgMusic.muted;
    document.getElementById("toggleMusic").innerText = bgMusic.muted ? "Unmute Music" : "Mute Music";
  };

  const cats = [
    { name: "Whiskers", price: 10, img: "https://placekitten.com/200/200" },
    { name: "Fluffy", price: 15, img: "https://placekitten.com/201/200" },
    { name: "Tiger", price: 20, img: "https://placekitten.com/200/201" },
  ];

  let currentUser = null;

  function updateLeaderboard() {
    db.ref("users").orderByChild("coins").limitToLast(10).once("value", snap => {
      const lb = [];
      snap.forEach(child => {
        const u = child.val();
        lb.push({ name: u.name, coins: u.coins || 0 });
      });
      lb.reverse();
      const html = lb.map(u => `<li>${u.name}: ${u.coins} coins</li>`).join("");
      document.getElementById("leaderboardList").innerHTML = html;
    });
  }

  function renderCats() {
    const catDiv = document.getElementById("cats");
    catDiv.innerHTML = "";
    cats.forEach(cat => {
      const div = document.createElement("div");
      div.className = "cat";
      div.innerHTML = `
        <img src="${cat.img}" />
        <p>${cat.name}</p>
        <p>${cat.price} coins</p>
        <button onclick="buyCat('${cat.name}')">Buy</button>`;
      catDiv.appendChild(div);
    });
  }

  function renderInventory(inv) {
    const invDiv = document.getElementById("inventory");
    invDiv.innerHTML = "";
    for (const name in inv) {
      const qty = inv[name];
      const cat = cats.find(c => c.name === name);
      const div = document.createElement("div");
      div.className = "cat";
      div.innerHTML = `
        <img src="${cat?.img}" />
        <p>${name} x${qty}</p>
        <button onclick="sellCat('${name}')">Sell</button>`;
      invDiv.appendChild(div);
    }
  }

  window.buyCat = function(name) {
    const uid = auth.currentUser.uid;
    db.ref("users/" + uid).once("value", snap => {
      const user = snap.val();
      const cat = cats.find(c => c.name === name);
      if (user.coins >= cat.price) {
        const inv = user.inventory || {};
        if (!inv[name]) {
          discoverSound.play();
        } else {
          meowSound.play();
        }
        inv[name] = (inv[name] || 0) + 1;
        db.ref("users/" + uid).update({
          coins: user.coins - cat.price,
          inventory: inv
        });
        renderInventory(inv);
        updateLeaderboard();
      }
    });
  };

  window.sellCat = function(name) {
    const uid = auth.currentUser.uid;
    db.ref("users/" + uid).once("value", snap => {
      const user = snap.val();
      const inv = user.inventory || {};
      if (inv[name] > 0) {
        const cat = cats.find(c => c.name === name);
        inv[name] -= 1;
        if (inv[name] === 0) delete inv[name];
        db.ref("users/" + uid).update({
          coins: user.coins + cat.price,
          inventory: inv
        });
        coinSound.play();
        renderInventory(inv);
        updateLeaderboard();
      }
    });
  };

  document.getElementById("btnLogin").onclick = () => {
    const email = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass).catch(err => {
      document.getElementById("loginMsg").innerText = err.message;
    });
  };

  document.getElementById("btnSignup").onclick = () => {
    const email = document.getElementById("username").value;
    const pass = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, pass).then(cred => {
      db.ref("users/" + cred.user.uid).set({
        name: email.split("@")[0],
        coins: 100,
        inventory: {}
      });
    }).catch(err => {
      document.getElementById("loginMsg").innerText = err.message;
    });
  };

  document.getElementById("btnLogout").onclick = () => auth.signOut();

  auth.onAuthStateChanged(user => {
    if (user) {
      currentUser = user;
      db.ref("users/" + user.uid).once("value", snap => {
        const data = snap.val();
        document.getElementById("displayName").innerText = data.name;
        document.getElementById("login").style.display = "none";
        document.getElementById("game").style.display = "block";
        renderCats();
        renderInventory(data.inventory || {});
        updateLeaderboard();
      });
    } else {
      document.getElementById("login").style.display = "block";
      document.getElementById("game").style.display = "none";
    }
  });
</script>
</body>
</html>
